{# Controles de Data e Atualização - Design moderno #}
<div class="flex flex-col gap-4 w-full lg:w-auto">
  {# Filtro de Data #}
  <form method="get" class="flex flex-wrap items-center gap-3" id="date-filter-form">
    {# Toggle entre Data Única e Intervalo #}
    <div class="flex items-center gap-2">
      <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
        Filtro:
      </label>
      <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
        <button type="button" 
          class="px-3 py-1 text-xs rounded-md transition-colors date-mode-btn" 
          data-mode="single"
          onclick="toggleDateMode('single')">
          <i data-lucide="calendar" class="w-3 h-3 inline mr-1"></i>
          Data Única
        </button>
        <button type="button" 
          class="px-3 py-1 text-xs rounded-md transition-colors date-mode-btn" 
          data-mode="range"
          onclick="toggleDateMode('range')">
          <i data-lucide="calendar-range" class="w-3 h-3 inline mr-1"></i>
          Intervalo
        </button>
      </div>
    </div>

    {# Filtro de Data Única #}
    <div id="single-date-filter" class="flex items-center gap-2">
      <label for="date-filter" class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">
        <i data-lucide="calendar" class="w-4 h-4 inline mr-1"></i>
        Data:
      </label>
      <input type="date" id="date-filter" name="filter_date" value="{{ filter_date }}"
        class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
        onchange="this.form.submit()" />
    </div>

    {# Filtro de Intervalo de Datas #}
    <div id="range-date-filter" class="flex items-center gap-2" style="display: none;">
      <label class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">
        <i data-lucide="calendar-range" class="w-4 h-4 inline mr-1"></i>
        Período:
      </label>
      <input type="date" id="start-date" name="start_date" value="{{ start_date }}"
        class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
        placeholder="Data inicial" />
      <span class="text-gray-500 dark:text-gray-400 text-sm">até</span>
      <input type="date" id="end-date" name="end_date" value="{{ end_date }}"
        class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
        placeholder="Data final" />
      <button type="submit" 
        class="px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 font-medium shadow-sm hover:shadow">
        <i data-lucide="search" class="w-4 h-4"></i>
        Filtrar
      </button>
    </div>

    {# Botão Hoje #}
    {% if not is_today %}
      <button type="submit" name="filter_date" value="{{ now|date:'Y-m-d' }}"
        class="px-4 py-2 text-sm bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors flex items-center gap-2 font-medium shadow-sm hover:shadow"
        title="Voltar para hoje">
        <i data-lucide="calendar-clock" class="w-4 h-4"></i>
        Hoje
      </button>
    {% endif %}
  </form>

  {# Informações de atualização #}
  <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-4">
    <i data-lucide="clock" class="w-4 h-4"></i>
    <span class="whitespace-nowrap">
      Última atualização:
      <time class="font-medium text-gray-700 dark:text-gray-300">{{ last_updated|default:'--:--:--' }}</time>
    </span>
  </div>
</div>

<script>
function toggleDateMode(mode) {
  const singleFilter = document.getElementById('single-date-filter');
  const rangeFilter = document.getElementById('range-date-filter');
  const buttons = document.querySelectorAll('.date-mode-btn');
  
  // Resetar estilos dos botões
  buttons.forEach(btn => {
    btn.classList.remove('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-gray-900', 'dark:text-white');
    btn.classList.add('text-gray-600', 'dark:text-gray-300');
  });
  
  if (mode === 'single') {
    singleFilter.style.display = 'flex';
    rangeFilter.style.display = 'none';
    
    // Limpar campos de intervalo
    document.getElementById('start-date').value = '';
    document.getElementById('end-date').value = '';
    
    // Destacar botão ativo
    const activeBtn = document.querySelector('[data-mode="single"]');
    activeBtn.classList.add('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-gray-900', 'dark:text-white');
    activeBtn.classList.remove('text-gray-600', 'dark:text-gray-300');
    
  } else if (mode === 'range') {
    singleFilter.style.display = 'none';
    rangeFilter.style.display = 'flex';
    
    // Limpar campo de data única
    document.getElementById('date-filter').value = '';
    
    // Destacar botão ativo
    const activeBtn = document.querySelector('[data-mode="range"]');
    activeBtn.classList.add('bg-white', 'dark:bg-gray-600', 'shadow-sm', 'text-gray-900', 'dark:text-white');
    activeBtn.classList.remove('text-gray-600', 'dark:text-gray-300');
  }
}

// Inicializar o modo baseado nos parâmetros atuais
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const hasRange = urlParams.has('start_date') || urlParams.has('end_date');
  
  if (hasRange) {
    toggleDateMode('range');
  } else {
    toggleDateMode('single');
  }
});
</script>
