{% load static %}
<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>
        {% block title %}Financial Dashboard{% endblock %} - Leguas Franzinas
    </title>

    <!-- InicializaÃ§Ã£o do tema ANTES do Tailwind -->
    <script>
      // Aplicar tema imediatamente para evitar flash
      const savedTheme = localStorage.getItem('financial-theme') || localStorage.getItem('management-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>

    <!-- Fontes modernas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              'sans': ['Inter', 'Segoe UI', 'Arial', 'sans-serif'],
            },
            colors: {
              primary: {
                50: '#eff6ff',
                100: '#dbeafe',
                200: '#bfdbfe',
                300: '#93c5fd',
                400: '#60a5fa',
                500: '#3b82f6',
                600: '#2563eb',
                700: '#1d4ed8',
                800: '#1e40af',
                900: '#1e3a8a',
              },
              success: {
                50: '#ecfdf5',
                100: '#d1fae5',
                200: '#a7f3d0',
                300: '#6ee7b7',
                400: '#34d399',
                500: '#10b981',
                600: '#059669',
                700: '#047857',
                800: '#065f46',
                900: '#064e3b',
              },
              warning: {
                50: '#fffbeb',
                100: '#fef3c7',
                200: '#fde68a',
                300: '#fcd34d',
                400: '#fbbf24',
                500: '#f59e0b',
                600: '#d97706',
                700: '#b45309',
                800: '#92400e',
                900: '#78350f',
              },
              danger: {
                50: '#fef2f2',
                100: '#fee2e2',
                200: '#fecaca',
                300: '#fca5a5',
                400: '#f87171',
                500: '#ef4444',
                600: '#dc2626',
                700: '#b91c1c',
                800: '#991b1b',
                900: '#7f1d1d',
              }
            },
            animation: {
              'slide-in': 'slideIn 0.3s ease-out',
              'fade-in': 'fadeIn 0.2s ease-out',
              'scale-in': 'scaleIn 0.2s ease-out',
            },
            transitionProperty: {
              'sidebar': 'transform, opacity, visibility',
            }
          },
        },
      }
    </script>

    <!-- Animations CSS -->
    <style>
      @keyframes slideIn {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes scaleIn {
        from {
          transform: scale(0.95);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      
      .fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }
      
      .slide-in {
        animation: slideIn 0.4s ease-out forwards;
      }
      
      .scale-in {
        animation: scaleIn 0.3s ease-out forwards;
      }
    </style>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Alpine.js for interactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">

    {% if messages %}
      <div id="flash-messages" class="fixed top-4 right-4 z-50 max-w-sm">
        {% for message in messages %}
          <div class="p-4 mb-4 rounded shadow-lg text-white {{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>

      <script>
        setTimeout(() => {
          const msgDiv = document.getElementById('flash-messages');
          if (msgDiv) {
            msgDiv.style.transition = 'opacity 0.5s ease-out';
            msgDiv.style.opacity = '0';
            setTimeout(() => msgDiv.remove(), 500);
          }
        }, 4000);
      </script>
    {% endif %}

    {% block extra_head %}
    {% endblock %}
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans transition-colors duration-300 antialiased">
    
    <!-- Dark Mode Toggle -->
    <div class="fixed top-4 right-4 z-50">
        <button
            id="darkModeToggle"
            class="group relative w-12 h-12 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full shadow-lg hover:shadow-xl border border-gray-200 dark:border-gray-700 transition-all duration-300 flex items-center justify-center"
            title="Alternar tema"
        >
            <i data-lucide="sun" class="sun-icon w-5 h-5 text-amber-500 transition-all duration-300 absolute dark:opacity-0 dark:rotate-90"></i>
            <i data-lucide="moon" class="moon-icon w-5 h-5 text-indigo-400 transition-all duration-300 absolute opacity-0 rotate-90 dark:opacity-100 dark:rotate-0"></i>
        </button>
    </div>
    
    <!-- Ãrea de NotificaÃ§Ãµes -->
    <div id="notification-area" class="fixed top-4 right-20 z-40 space-y-3 max-w-sm"></div>

    <div class="min-h-screen flex bg-gray-50 dark:bg-gray-900">
      <!-- Overlay para mobile -->
      <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 dark:bg-black/70 z-30 lg:hidden hidden transition-opacity duration-300 backdrop-blur-sm"></div>
      
      <!-- Sidebar -->
      {% include 'paack_dashboard/partials/sidebar.html' %}
      
      <!-- BotÃ£o de toggle da sidebar (mobile) -->
      <button id="sidebar-toggle" class="fixed top-4 left-4 z-40 lg:hidden bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-lg shadow-lg transition-colors duration-200">
        <i data-lucide="menu" class="w-5 h-5"></i>
      </button>

      <!-- ConteÃºdo principal -->
      <div class="flex-1 flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900">
        <main class="flex-1 p-4 lg:p-8">
          {% block content %}{% endblock %}
        </main>
        
        <!-- Footer opcional -->
        <footer class="mt-auto py-4 px-4 lg:px-8 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
          <div class="text-center text-sm text-gray-500 dark:text-gray-400">
            Â© 2025 Leguas Franzinas - Sistema Financeiro
          </div>
        </footer>
      </div>
    </div>

    <!-- Scripts -->
    <script src="{% static 'paack_dashboard/js/sidebar.js' %}"></script>

    <script>
      // Dark mode toggle
      document.addEventListener('DOMContentLoaded', function() {
        const darkModeToggle = document.getElementById('darkModeToggle');
        
        if (darkModeToggle) {
          darkModeToggle.addEventListener('click', function() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
              html.classList.remove('dark');
              localStorage.setItem('financial-theme', 'light');
              localStorage.setItem('management-theme', 'light');
            } else {
              html.classList.add('dark');
              localStorage.setItem('financial-theme', 'dark');
              localStorage.setItem('management-theme', 'dark');
            }
            
            // Reinitialize lucide icons
            if (typeof lucide !== 'undefined') {
              lucide.createIcons();
            }
          });
        }
        
        // Initialize lucide icons
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      });
    </script>

    {% block extra_js %}
    {% endblock %}
</body>
</html>
