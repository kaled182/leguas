{% extends "settlements/base.html" %}
{% load static %}

{% block subtitle %}Invoice #{{ invoice.invoice_number }}{% endblock %}

{% block settlements_content %}
<div class="mb-6">
  <a href="{% url 'invoice-list' %}" class="text-blue-600 hover:text-blue-900 text-sm mb-2 inline-block">← Voltar</a>
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Invoice {{ invoice.invoice_number }}</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-400">{{ invoice.partner.name }}</p>
    </div>
    <div class="flex space-x-3">
      <a href="{% url 'invoice-pdf' invoice.id %}" class="btn">Download PDF</a>
      <a href="/admin/settlements/partnerinvoice/{{ invoice.id }}/change/" class="btn btn-secondary">Editar</a>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="card">
    <div class="card-header"><h3 class="card-title">Informações</h3></div>
    <div class="card-body space-y-3">
      <div><p class="text-xs text-gray-500">Número</p><p class="font-medium">{{ invoice.invoice_number }}</p></div>
      <div><p class="text-xs text-gray-500">Período</p><p class="font-medium">{{ invoice.period_start|date:"d/m/Y" }} - {{ invoice.period_end|date:"d/m/Y" }}</p></div>
      <div><p class="text-xs text-gray-500">Status</p>
        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full 
          {% if invoice.status == 'PAID' %}bg-green-100 text-green-800
          {% elif invoice.status == 'OVERDUE' %}bg-red-100 text-red-800
          {% else %}bg-yellow-100 text-yellow-800{% endif %}">
          {{ invoice.get_status_display }}
        </span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><h3 class="card-title">Valores</h3></div>
    <div class="card-body space-y-2">
      <div class="flex justify-between"><span>Bruto</span><span class="font-medium">€{{ invoice.gross_amount|floatformat:2 }}</span></div>
      <div class="flex justify-between"><span>IVA (23%)</span><span class="font-medium">€{{ invoice.tax_amount|floatformat:2 }}</span></div>
      <div class="border-t pt-2 flex justify-between"><span class="font-bold">Total</span><span class="font-bold text-green-600">€{{ invoice.net_amount|floatformat:2 }}</span></div>
    </div>
  </div>
</div>

{% if related_orders %}
<div class="card mt-6">
  <div class="card-header"><h3 class="card-title">Pedidos ({{ related_orders.count }})</h3></div>
  <div class="card-body">
    <div class="overflow-x-auto">
      <table class="data-table">
        <thead><tr><th>Data</th><th>Código</th><th>Motorista</th><th>Status</th></tr></thead>
        <tbody>
          {% for order in related_orders %}
          <tr>
            <td>{{ order.created_at|date:"d/m/Y" }}</td>
            <td>{{ order.tracking_code }}</td>
            <td>{{ order.assigned_driver.user.get_full_name|default:"-" }}</td>
            <td><span class="px-2 py-1 text-xs rounded {% if order.status == 'DELIVERED' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">{{ order.get_status_display }}</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
